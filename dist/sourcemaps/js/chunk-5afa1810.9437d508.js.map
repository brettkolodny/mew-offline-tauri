{"version":3,"sources":["webpack:///./src/core/helpers/toBuffer.js","webpack:///./src/modules/message/ModuleMessageVerify.vue?25ba","webpack:///src/modules/message/ModuleMessageVerify.vue","webpack:///./src/modules/message/ModuleMessageVerify.vue?0b63","webpack:///./src/modules/message/ModuleMessageVerify.vue","webpack:///./src/modules/message/errors.js","webpack:///./src/modules/message/handlers/index.js"],"names":["toBuffer","v","isHexString","utilsToBuffer","Buffer","from","render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","title","scopedSlots","_u","key","fn","message","model","value","callback","$$v","expression","_v","_s","signer","_e","$t","class","signResult","verificationError","nativeOn","$event","clearAll","apply","arguments","verifyMessage","proxy","staticRenderFns","name","components","data","didSign","didntSign","computed","mounted","methods","signCheck","toChecksumAddress","component","SIGN_FAILED","INVALID_LENGTH","FAILED_TO_VERIFY","SignAndVerifyMessage","$store","vuexStore","Object","assign","mapState","_this","web3","eth","sign","address","then","_signedMessage","signature","JSON","stringify","msg","sig","version","isHardware","identifier","e","ErrorList","json","parse","hash","hashPersonalMessage","replace","length","utils","sha3","pubKey","ecrecover","slice","verified","toLowerCase","pubToAddress","toString"],"mappings":"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","file":"js/chunk-5afa1810.9437d508.js","sourcesContent":["import { isHexString, toBuffer as utilsToBuffer } from 'ethereumjs-util';\n\nconst toBuffer = v => {\n  if (isHexString(v)) {\n    return utilsToBuffer(v);\n  }\n  return Buffer.from(v);\n};\nexport default toBuffer;\n","var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('mew-module',{staticClass:\"d-flex flex-grow-1 pt-6\",attrs:{\"title\":_vm.title,\"has-elevation\":true,\"has-indicator\":true},scopedSlots:_vm._u([{key:\"moduleBody\",fn:function(){return [_c('v-textarea',{staticClass:\"VerifyInput\",attrs:{\"outlined\":\"\",\"label\":\"Signature\",\"value\":_vm.message},model:{value:(_vm.message),callback:function ($$v) {_vm.message=$$v},expression:\"message\"}}),(_vm.signResult)?_c('div',{staticClass:\"walletBg pa-3 VerifyMessage\"},[_vm._v(\" \"+_vm._s(_vm.signer)+\" \"),(_vm.didSign)?_c('span',{staticClass:\"font-weight-medium\"},[_vm._v(\" did sign the message \")]):_vm._e(),(_vm.didntSign)?_c('span',{staticClass:\"font-weight-medium\"},[_vm._v(\" didn't sign the message \")]):_vm._e()]):_vm._e(),(_vm.verificationError)?_c('div',{staticClass:\"walletBg pa-3\"},[_vm._v(\" \"+_vm._s(_vm.$t('signMessage.failed'))+\" \")]):_vm._e(),_c('div',{class:['text-right', _vm.signResult || _vm.verificationError ? 'pt-3' : '']},[_c('mew-button',{staticClass:\"mr-4\",attrs:{\"btn-style\":\"light\",\"title\":\"Clear all\"},nativeOn:{\"click\":function($event){return _vm.clearAll.apply(null, arguments)}}}),_c('mew-button',{attrs:{\"disabled\":!_vm.message,\"title\":\"Verify\"},nativeOn:{\"click\":function($event){return _vm.verifyMessage.apply(null, arguments)}}})],1)]},proxy:true}])})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <mew-module\n    class=\"d-flex flex-grow-1 pt-6\"\n    :title=\"title\"\n    :has-elevation=\"true\"\n    :has-indicator=\"true\"\n  >\n    <template #moduleBody>\n      <v-textarea\n        v-model=\"message\"\n        class=\"VerifyInput\"\n        outlined\n        label=\"Signature\"\n        :value=\"message\"\n      ></v-textarea>\n\n      <div v-if=\"signResult\" class=\"walletBg pa-3 VerifyMessage\">\n        {{ signer }}\n        <span v-if=\"didSign\" class=\"font-weight-medium\">\n          did sign the message\n        </span>\n        <span v-if=\"didntSign\" class=\"font-weight-medium\">\n          didn't sign the message\n        </span>\n      </div>\n\n      <div v-if=\"verificationError\" class=\"walletBg pa-3\">\n        {{ $t('signMessage.failed') }}\n      </div>\n\n      <div\n        :class=\"['text-right', signResult || verificationError ? 'pt-3' : '']\"\n      >\n        <mew-button\n          btn-style=\"light\"\n          title=\"Clear all\"\n          class=\"mr-4\"\n          @click.native=\"clearAll\"\n        />\n        <mew-button\n          :disabled=\"!message\"\n          title=\"Verify\"\n          @click.native=\"verifyMessage\"\n        />\n      </div>\n    </template>\n  </mew-module>\n</template>\n\n<script>\nimport { toChecksumAddress } from 'ethereumjs-util';\n\nimport SignAndVerifyMessage from '@/modules/message/handlers';\nexport default {\n  name: 'ModuleMessageVerify',\n  components: {},\n  data() {\n    return {\n      title: 'Verify Message',\n      didSign: false,\n      didntSign: false,\n      signResult: false,\n      verificationError: false,\n      message: '',\n      signer: ''\n    };\n  },\n  computed: {},\n  mounted() {\n    this.signAndVerify = new SignAndVerifyMessage(this.web3, this.address);\n  },\n  methods: {\n    verifyMessage() {\n      try {\n        this.verificationError = false;\n        this.signResult = false;\n        this.didSign = false;\n        this.didntSign = false;\n        const signCheck = this.signAndVerify.verifyMessage(this.message);\n        const parsedMessage = JSON.parse(this.message);\n        if (!parsedMessage.address) {\n          this.verificationError = true;\n          return;\n        }\n        if (\n          signCheck.verified &&\n          toChecksumAddress(parsedMessage.address) ===\n            toChecksumAddress('0x' + signCheck.signer)\n        ) {\n          this.didSign = true;\n        } else {\n          this.didntSign = true;\n        }\n        this.signer = parsedMessage.address;\n        this.signResult = true;\n      } catch {\n        this.verificationError = true;\n      }\n    },\n    clearAll() {\n      this.verificationError = false;\n      this.didntSign = false;\n      this.didSign = false;\n      this.signResult = false;\n      this.message = '';\n      this.signer = '';\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModuleMessageVerify.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModuleMessageVerify.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ModuleMessageVerify.vue?vue&type=template&id=0fa72462&scoped=true&\"\nimport script from \"./ModuleMessageVerify.vue?vue&type=script&lang=js&\"\nexport * from \"./ModuleMessageVerify.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"0fa72462\",\n  null\n  \n)\n\nexport default component.exports","export default {\n  SIGN_FAILED: 'Failed to sign message',\n  INVALID_LENGTH: 'Invalid signature length',\n  FAILED_TO_VERIFY: 'Failed to verify signature'\n};\n","import { hashPersonalMessage, ecrecover, pubToAddress } from 'ethereumjs-util';\nimport toBuffer from '@/core/helpers/toBuffer';\nimport vuexStore from '@/core/store';\nimport { mapState } from 'vuex';\nimport ErrorList from '../errors';\n\nexport default class SignAndVerifyMessage {\n  constructor() {\n    this.$store = vuexStore;\n    Object.assign(\n      this,\n      mapState('wallet', ['web3', 'address', 'isHardware', 'identifier'])\n    );\n  }\n\n  signMessage(message) {\n    const _this = this;\n    try {\n      return this.web3()\n        .eth.sign(message, this.address())\n        .then(_signedMessage => {\n          _this.signature = JSON.stringify(\n            {\n              address: _this.address(),\n              msg: _this.message,\n              sig: _signedMessage,\n              version: '3',\n              signer: _this.isHardware() ? _this.identifier() : 'MEW'\n            },\n            null,\n            2\n          );\n          return _this.signature;\n        });\n    } catch (e) {\n      throw ErrorList.SIGN_FAILED;\n    }\n  }\n\n  verifyMessage(message) {\n    try {\n      const json = JSON.parse(message);\n      let hash = hashPersonalMessage(toBuffer(json.msg));\n      const sig = Buffer.from(json.sig.replace('0x', ''), 'hex');\n      if (sig.length !== 65) {\n        throw ErrorList.INVALID_LENGTH;\n      }\n      sig[64] = sig[64] === 0 || sig[64] === 1 ? sig[64] + 27 : sig[64];\n      if (json.version === '1') {\n        hash = this.web3().utils.sha3(json.msg);\n      }\n      const pubKey = ecrecover(\n        hash,\n        sig[64],\n        sig.slice(0, 32),\n        sig.slice(32, 64)\n      );\n      return {\n        verified:\n          !json.address.replace('0x', '').toLowerCase() !==\n          pubToAddress(pubKey).toString('hex').toLowerCase(),\n        signer: pubToAddress(pubKey).toString('hex').toLowerCase()\n      };\n    } catch (e) {\n      throw ErrorList.FAILED_TO_VERIFY;\n    }\n  }\n}\n"],"sourceRoot":""}