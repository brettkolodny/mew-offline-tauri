{"version":3,"sources":["webpack:///./src/modules/message/ModuleMessageSign.vue?72bb","webpack:///src/modules/message/ModuleMessageSign.vue","webpack:///./src/modules/message/ModuleMessageSign.vue?8a8f","webpack:///./src/modules/message/ModuleMessageSign.vue","webpack:///./src/core/helpers/toBuffer.js","webpack:///./src/modules/message/errors.js","webpack:///./src/modules/message/handlers/index.js"],"names":["render","_vm","this","_h","$createElement","_c","_self","staticClass","attrs","title","scopedSlots","_u","key","fn","message","model","value","callback","$$v","expression","nativeOn","$event","clearAll","apply","arguments","disableSignBtn","signMessage","proxy","staticRenderFns","name","data","signature","signAndVerify","computed","mapState","mounted","methods","component","toBuffer","v","isHexString","utilsToBuffer","Buffer","from","SIGN_FAILED","INVALID_LENGTH","FAILED_TO_VERIFY","SignAndVerifyMessage","$store","vuexStore","Object","assign","_this","web3","eth","sign","address","then","_signedMessage","JSON","stringify","msg","sig","version","signer","isHardware","identifier","e","ErrorList","json","parse","hash","hashPersonalMessage","replace","length","utils","sha3","pubKey","ecrecover","slice","verified","toLowerCase","pubToAddress","toString"],"mappings":"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","file":"js/chunk-4e15e8d4.c55a2573.js","sourcesContent":["var render = function () {var _vm=this;var _h=_vm.$createElement;var _c=_vm._self._c||_h;return _c('mew-module',{staticClass:\"d-flex flex-grow-1 pt-6\",attrs:{\"title\":_vm.title,\"has-elevation\":true,\"has-indicator\":true},scopedSlots:_vm._u([{key:\"moduleBody\",fn:function(){return [_c('div',[_c('v-textarea',{attrs:{\"outlined\":\"\",\"label\":\"Signature\",\"value\":_vm.message},model:{value:(_vm.message),callback:function ($$v) {_vm.message=$$v},expression:\"message\"}}),_c('div',{staticClass:\"text-right\"},[_c('mew-button',{staticClass:\"mr-4\",attrs:{\"btn-style\":\"light\",\"title\":\"Clear all\"},nativeOn:{\"click\":function($event){return _vm.clearAll.apply(null, arguments)}}}),_c('mew-button',{attrs:{\"title\":\"Sign\",\"disabled\":_vm.disableSignBtn},nativeOn:{\"click\":function($event){return _vm.signMessage.apply(null, arguments)}}})],1)],1)]},proxy:true}])})}\nvar staticRenderFns = []\n\nexport { render, staticRenderFns }","<template>\n  <mew-module\n    class=\"d-flex flex-grow-1 pt-6\"\n    :title=\"title\"\n    :has-elevation=\"true\"\n    :has-indicator=\"true\"\n  >\n    <template #moduleBody>\n      <div>\n        <v-textarea\n          v-model=\"message\"\n          outlined\n          label=\"Signature\"\n          :value=\"message\"\n        ></v-textarea>\n        <div class=\"text-right\">\n          <mew-button\n            btn-style=\"light\"\n            title=\"Clear all\"\n            class=\"mr-4\"\n            @click.native=\"clearAll\"\n          />\n          <mew-button\n            title=\"Sign\"\n            :disabled=\"disableSignBtn\"\n            @click.native=\"signMessage\"\n          />\n        </div>\n      </div>\n    </template>\n  </mew-module>\n</template>\n\n<script>\nimport { mapState } from 'vuex';\n\nimport SignAndVerifyMessage from '@/modules/message/handlers';\nexport default {\n  name: 'ModuleMessageSign',\n  data() {\n    return {\n      title: 'Sign Message',\n      message: '',\n      signature: '',\n      signAndVerify: ''\n    };\n  },\n  computed: {\n    ...mapState('wallet', ['instance']),\n    disableSignBtn() {\n      return this.message === '';\n    }\n  },\n  mounted() {\n    this.signAndVerify = new SignAndVerifyMessage();\n  },\n  methods: {\n    signMessage() {\n      try {\n        this.signAndVerify.signMessage(this.message).catch(e => {\n          this.instance.errorHandler(e.message);\n        });\n      } catch (e) {\n        this.instance.errorHandler(e.hasOwnProperty('message') ? e.message : e);\n      }\n    },\n    clearAll() {\n      this.signature = '';\n      this.message = '';\n    }\n  }\n};\n</script>\n\n<style lang=\"scss\" scoped></style>\n","import mod from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModuleMessageSign.vue?vue&type=script&lang=js&\"; export default mod; export * from \"-!../../../node_modules/cache-loader/dist/cjs.js??ref--13-0!../../../node_modules/thread-loader/dist/cjs.js!../../../node_modules/babel-loader/lib/index.js!../../../node_modules/cache-loader/dist/cjs.js??ref--1-0!../../../node_modules/vue-loader/lib/index.js??vue-loader-options!./ModuleMessageSign.vue?vue&type=script&lang=js&\"","import { render, staticRenderFns } from \"./ModuleMessageSign.vue?vue&type=template&id=f7d1908a&scoped=true&\"\nimport script from \"./ModuleMessageSign.vue?vue&type=script&lang=js&\"\nexport * from \"./ModuleMessageSign.vue?vue&type=script&lang=js&\"\n\n\n/* normalize component */\nimport normalizer from \"!../../../node_modules/vue-loader/lib/runtime/componentNormalizer.js\"\nvar component = normalizer(\n  script,\n  render,\n  staticRenderFns,\n  false,\n  null,\n  \"f7d1908a\",\n  null\n  \n)\n\nexport default component.exports","import { isHexString, toBuffer as utilsToBuffer } from 'ethereumjs-util';\n\nconst toBuffer = v => {\n  if (isHexString(v)) {\n    return utilsToBuffer(v);\n  }\n  return Buffer.from(v);\n};\nexport default toBuffer;\n","export default {\n  SIGN_FAILED: 'Failed to sign message',\n  INVALID_LENGTH: 'Invalid signature length',\n  FAILED_TO_VERIFY: 'Failed to verify signature'\n};\n","import { hashPersonalMessage, ecrecover, pubToAddress } from 'ethereumjs-util';\nimport toBuffer from '@/core/helpers/toBuffer';\nimport vuexStore from '@/core/store';\nimport { mapState } from 'vuex';\nimport ErrorList from '../errors';\n\nexport default class SignAndVerifyMessage {\n  constructor() {\n    this.$store = vuexStore;\n    Object.assign(\n      this,\n      mapState('wallet', ['web3', 'address', 'isHardware', 'identifier'])\n    );\n  }\n\n  signMessage(message) {\n    const _this = this;\n    try {\n      return this.web3()\n        .eth.sign(message, this.address())\n        .then(_signedMessage => {\n          _this.signature = JSON.stringify(\n            {\n              address: _this.address(),\n              msg: _this.message,\n              sig: _signedMessage,\n              version: '3',\n              signer: _this.isHardware() ? _this.identifier() : 'MEW'\n            },\n            null,\n            2\n          );\n          return _this.signature;\n        });\n    } catch (e) {\n      throw ErrorList.SIGN_FAILED;\n    }\n  }\n\n  verifyMessage(message) {\n    try {\n      const json = JSON.parse(message);\n      let hash = hashPersonalMessage(toBuffer(json.msg));\n      const sig = Buffer.from(json.sig.replace('0x', ''), 'hex');\n      if (sig.length !== 65) {\n        throw ErrorList.INVALID_LENGTH;\n      }\n      sig[64] = sig[64] === 0 || sig[64] === 1 ? sig[64] + 27 : sig[64];\n      if (json.version === '1') {\n        hash = this.web3().utils.sha3(json.msg);\n      }\n      const pubKey = ecrecover(\n        hash,\n        sig[64],\n        sig.slice(0, 32),\n        sig.slice(32, 64)\n      );\n      return {\n        verified:\n          !json.address.replace('0x', '').toLowerCase() !==\n          pubToAddress(pubKey).toString('hex').toLowerCase(),\n        signer: pubToAddress(pubKey).toString('hex').toLowerCase()\n      };\n    } catch (e) {\n      throw ErrorList.FAILED_TO_VERIFY;\n    }\n  }\n}\n"],"sourceRoot":""}